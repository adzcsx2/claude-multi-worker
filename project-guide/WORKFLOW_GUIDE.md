# Vibe Coding 工作流程指南

> 详细操作流程和使用示例

---

## 📋 目录

- [新建项目流程](#模式-a新建项目检测到新项目)
- [继续开发流程](#模式-b继续开发检测到已有项目)
- [8种操作详解](#详细操作流程)
- [使用示例](#使用示例)

---

## Claude AI 读取规则（重要）

```yaml
# IMPORTANT: Claude 在每次对话开始时必须执行：
# 1. 检查当前目录是否存在 memory-bank/ 文件夹
# 2. 如果不存在 → 进入"新建项目"流程
# 3. 如果存在 → 读取 memory-bank/05-progress.md 和 memory-bank/04-architecture.md
# 4. 根据项目状态向用户展示对应的操作菜单
```

---

## 模式 A：新建项目（检测到新项目）

当 `memory-bank/` 文件夹不存在时触发。

### 📋 项目信息收集

Claude 将询问以下信息：

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🆕 检测到新项目，让我们开始吧！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请提供以下信息：

1️⃣  项目名称
   > [用户输入]

2️⃣ 项目类型
   □ Android App
   □ iOS App
   □ Web 前端 (React/Vue/等)
   □ 后端 API
   □ 桌面应用
   □ 游戏
   □ 其他：_____

3️⃣ 项目描述（简要说明项目要做什么）
   > [用户输入]

4️⃣ 核心功能（列出 3-5 个主要功能）
   1. _____
   2. _____
   3. _____

5️⃣ 开发环境/工具
   □ Android Studio
   □ VS Code
   □ IntelliJ IDEA
   □ 其他：_____

信息收集完成后，我将自动生成项目结构。
```

### 📁 自动创建项目结构

```
{项目根目录}/
├── memory-bank/                    # 项目文档核心
│   ├── 01-tech-stack.md           # 技术栈选型
│   ├── 02-product-requirements.md # 产品需求文档
│   ├── 03-implementation-plan.md  # 实施计划
│   ├── 04-architecture.md         # 架构文档
│   └── 05-progress.md             # 进度跟踪
│
├── docs/                          # 额外文档（可选）
│   └── api-design.md
│
├── test/                          # 测试文件目录（自动创建）
│   ├── screenshots/               # 测试截图
│   ├── reports/                   # 测试报告
│   ├── scripts/                   # 测试脚本
│   ├── logs/                      # 测试日志
│   └── temp/                      # 临时文件
│
└── src/                           # 源代码目录（根据项目类型创建）
```

### 📄 自动生成文档模板

根据用户提供的信息，Claude 将生成对应项目的定制化文档。

---

## 模式 B：继续开发（检测到已有项目）

当 `memory-bank/` 文件夹和 `05-progress.md` 都存在时触发。

### 📊 当前状态概览

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 项目：{项目名称}
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📈 进度：已完成 5/20 步 (25%)

✅ 最近完成：
   • Step 5: 用户登录功能

🔄 当前阶段：
   • Step 6: 个人资料页面

⏭️  下一步：
   • Step 7: 消息通知功能
```

### 🎯 操作菜单

| 编号 | 操作 | 说明 |
|-----|------|------|
| **1** | **继续下一步** | 自动执行下一个未完成的步骤 |
| **2** | **查看进度** | 显示完整的进度报告 |
| **3** | **查看架构** | 显示项目架构和文件结构 |
| **4** | **添加新功能** | 在现有基础上增加新功能 |
| **5** | **修改需求** | 更新产品需求或技术栈 |
| **6** | **修复问题** | 调试和修复 Bug |
| **7** | **代码重构** | 优化代码结构 |
| **8** | **跳到指定步骤** | 跳转到某个特定步骤 |

---

## 详细操作流程

### 操作 1：继续下一步

```
┌─────────────────────────────────────┐
📌 Step 6: 个人资料页面              │
──────────────────────────────────────│
任务：                                 │
  □ 创建个人资料 UI                   │
  □ 实现头像上传                      │
  □ 实现信息编辑                      │
──────────────────────────────────────│
验收标准：                              │
  • 能显示用户头像和基本信息            │
  • 可以编辑并保存更改                  │
──────────────────────────────────────│

开始执行此步骤？(y/s/n)
  y - 是，开始执行
  s - 跳过此步骤
  n - 取消，返回菜单
└─────────────────────────────────────┘
```

**执行流程（完全自动化）：**
1. 用户确认后，Claude 读取 `04-architecture.md` 和 `01-tech-stack.md`
2. 编写代码
3. **编译项目**（确保代码没有语法错误）⚠️ **编译必须通过才能继续，编译失败绝对不允许跳过**
4. **自动生成并运行测试（编译通过后才能执行，Android必须全部通过才能继续）**
   - 【Android】单元测试: 检查测试目录 → 不存在则自动创建并编写测试 → ./gradlew testDebugUnitTest → **必须通过**
   - 【Android】UI自动化测试: 检查adb连接 → 自动选择/创建/启动模拟器 → 自动编写UI测试 → ./gradlew connectedDebugAndroidTest → **必须通过**
   - 【Android】UI模拟测试（adb控制模拟器）: 启动应用 → 模拟用户操作（点击、滑动、输入） → 执行端到端流程测试 → 截图保存 → **必须通过**
   - 【Web】npm test
   - 所有测试必须通过，失败则自动修复并重测
5. 如果编译失败 → **自动修复问题并重新编译，编译失败不允许跳过，不允许进行下一步**
6. 如果测试失败 → 自动修复问题并重新执行步骤 3-5
7. 编译和测试全部通过后，**自动更新** `05-progress.md`（标记为完成，无需用户确认）
8. 更新 `04-architecture.md`（如有结构变化）
9. **自动执行 Git 提交**（创建回滚节点）
10. 返回操作菜单

```bash
# 每个步骤完成后自动执行：
git add .
git commit -m "feat: step X - [步骤名称]"
```

---

### 操作 2：查看进度

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 完整进度报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

阶段 1: 基础设施 (3/3) ✅
  ✅ Step 1: 项目初始化
  ✅ Step 2: 数据库设计
  ✅ Step 3: API 框架搭建

阶段 2: 核心功能 (2/5) 🔄
  ✅ Step 4: 用户认证
  ✅ Step 5: 用户登录
  🔄 Step 6: 个人资料页面 ← 当前
  ⏳ Step 7: 消息通知
  ⏳ Step 8: 搜索功能

阶段 3: 高级功能 (0/8) ⏳
  ⏳ Step 9-16: ...

总计: 5/16 步骤完成 (31%)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### 操作 3：查看架构

显示当前项目的技术栈和文件结构。

---

### 操作 4：添加新功能

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
➕ 添加新功能
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请描述你想要添加的功能：

功能名称: _
功能描述: _
优先级: □ 高 □ 中 □ 低

Claude 将：
1. 分析功能需求
2. 创建新的实施步骤
3. 更新 03-implementation-plan.md
4. 询问是否立即开始开发
```

---

### 操作 5：修改需求

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✏️ 修改需求
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

当前需求：[显示 02-product-requirements.md 摘要]

要修改的内容：
□ 添加功能
□ 修改现有功能
□ 删除功能
□ 更改技术栈

请详细说明: _
```

---

### 操作 6：修复问题

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🐛 修复问题
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请描述遇到的问题：

1. 问题出现在哪里？（哪个功能/文件）
2. 期望行为是什么？
3. 实际发生了什么？
4. 有错误信息吗？

Claude 将：
1. 定位问题代码
2. 分析原因
3. 提供解决方案
4. 修复代码
5. 添加测试防止回归
```

---

### 操作 7：代码重构

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔧 代码重构
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

重构范围：
□ 整个项目
□ 特定模块/文件：_____

重构目标：
□ 提升性能
□ 改善可读性
□ 减少耦合
□ 消除重复代码
```

---

### 操作 8：跳到指定步骤

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⏭️  跳转到指定步骤
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

可用步骤：
  Step 1:  项目初始化      ✅
  Step 2:  数据库设计      ✅
  Step 3:  API 框架搭建    ✅
  Step 4:  用户认证        ✅
  Step 5:  用户登录        ✅
  Step 6:  个人资料页面    🔄
  Step 7:  消息通知        ⏳
  ...

跳转到步骤: _
```

---

## 💡 使用示例

### 示例 1：全新项目

```
你: 我想做一个待办事项应用

Claude: 检测到新项目！
        ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        🆕 让我们创建你的项目
        ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        1️⃣  项目名称: _
        2️⃣  项目类型:
            □ Android App
            □ Web 前端
            ...
```

### 示例 2：继续开发

```
你: 继续

Claude: ┌─────────────────────────────────────┐
        📌 Step 6: 个人资料页面              │
        │                                     │
        │ 任务：                              │
        │   □ 创建个人资料 UI                 │
        │   □ 实现头像上传                    │
        │   □ 实现信息编辑                    │
        │                                     │
        │ 开始执行？(y/n)                     │
        └─────────────────────────────────────┘

你: y

Claude: 开始执行...
        [编写代码...]

        ✅ 代码完成

        🔨 编译项目...
        [执行] ./gradlew build
        [OK] BUILD SUCCESSFUL

        🧪 准备单元测试...
        [检查] src/test/java/ 目录是否存在...
        [结果] 目录不存在，自动创建测试目录结构
        [创建] src/test/java/com/example/app/
        [编写] 为新增功能自动编写单元测试...
        [创建] UserProfileTest.kt (测试用户资料功能)
        [创建] ProfileValidatorTest.kt (测试输入验证)

        🧪 运行单元测试...
        [执行] ./gradlew testDebugUnitTest
        [保存] 测试报告到 test/reports/unit/
        [OK] 15 unit tests passed

        🧪 准备UI测试（完全自动化）...
        [检查] test/ 文件夹是否存在...
        [结果] 不存在，自动创建 test/ 目录结构
        [创建] test/screenshots/ui/
        [创建] test/reports/ui/
        [创建] test/logs/logcat/
        [检查] adb devices
        [结果] 无连接设备

        [列出] emulator -list-avds
        [可用] 找到 2 个模拟器: pixel_5_api_33, pixel_6_api_34
        [自动] 选择第一个可用模拟器: pixel_5_api_33
        [启动] emulator -avd pixel_5_api_33 &
        [等待] adb wait-for-device
        [OK] 模拟器已启动并连接

        🧪 运行UI模拟测试（通过adb控制模拟器）...
        [检查] adb devices
        [结果] 无连接设备

        [列出] emulator -list-avds
        [可用] 找到 2 个模拟器: pixel_5_api_33, pixel_6_api_34
        [自动] 选择第一个可用模拟器: pixel_5_api_33
        [启动] emulator -avd pixel_5_api_33 &
        [等待] adb wait-for-device
        [OK] 模拟器已启动并连接

        [启动] 启动应用并验证主界面加载...
        [OK] 主界面加载成功
        [模拟] 点击头像区域...
        [OK] 点击响应正常
        [模拟] 滑动到编辑按钮...
        [OK] 滑动操作成功
        [模拟] 点击编辑按钮...
        [OK] 进入编辑模式
        [模拟] 输入测试文本...
        [OK] 输入响应正常
        [模拟] 点击保存按钮...
        [OK] 保存操作成功
        [模拟] 返回操作...
        [OK] 返回主界面
        [截图] UI模拟测试截图保存到 test/screenshots/ui-simulation/
        [保存] 操作日志保存到 test/logs/ui-simulation/
        [保存] 测试报告保存到 test/reports/ui-simulation/
        [检测] 无UI响应问题，无操作失败，无界面卡顿，无crash，无ANR
        [OK] 6 UI simulation tests passed

        📋 测试验证结果:
        ✅ 单元测试: 15/15 通过 - 必须通过
        ✅ UI模拟测试: 6/6 通过 - 必须通过
        ⚠️  两个测试都必须通过才能继续下一步

        📋 测试报告:
        ✅ 编译: 通过
        ✅ 单元测试: 15/15 通过（自动创建测试目录并自动编写测试）
        ✅ UI模拟测试: 6/6 通过（通过adb模拟真实用户操作并验证）
        ✅ 测试输出: 已保存到 test/ 目录

        测试全部通过！自动更新进度...

        ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        📝 场景说明: 如果没有可用模拟器（完全自动化）
        ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
        [列出] emulator -list-avds
        [结果] 无可用模拟器

        [自动] 创建模拟器（无需用户确认）
        [命令] avdmanager create avd -n pixel_5_api_33 -k "system-images;android-33;google_apis;x86_64" -d "pixel_5"
        [OK] 模拟器创建成功

        [自动] 启动模拟器
        [启动] emulator -avd pixel_5_api_33 &
        [等待] adb wait-for-device
        [OK] 模拟器已启动并连接
        ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

        📦 自动提交 Git：
        [执行] git add .
        [执行] git commit -m "feat: step 6 - 添加个人资料页面"
        [OK] commit abc1234

        ✅ Step 6 完成！

        ━━━━━━━━━━━━━━━━━━━━━━
        回到菜单，等待下一个指令
        ━━━━━━━━━━━━━━━━━━━━━━
```

---

*本文档遵循 Vibe Coding 方法论 V1.2.2*
